<?php
/**
 * EXB R5 - Business suite
 * Copyright (C) EXB Software 2020 - All Rights Reserved
 *
 * This file is part of EXB R5.
 *
 * Unauthorized copying of this file, via any medium is strictly prohibited
 * Proprietary and confidential
 */
use EXB\R5\Modules as R5Modules;
use EXB\IM\Bridge\Modules;
use EXB\Kernel\Document\Factory;
use EXB\Kernel\Foundation\Services;
use EXB\Kernel\Template\StringLoader;
use EXB\Kernel\Template\FileLoader;
use EXB\R4\Login\Identity\Named as NamedIdentity;
use EXB\R4\Login\LoginService;

use EXB\Kernel\Document\Model\SaveHandler\Event\SaveEvent;
use EXB\Kernel\Document\Model\SaveHandler\SaveHandlerEvents;
use EXB\Kernel\Document\Model\SavePayload;

use Elastica\Query\BoolQuery;
use Elastica\Query\Term;
use Elastica\Query\Terms;
use EXB\Kernel\Report\CustomFilter;
use EXB\Kernel\Report\Filter;
use EXB\Kernel\Database;
use EXB\Kernel\Localization;
use \Cocur\Slugify\Slugify;
use Ramsey\Uuid\Uuid;
require_once __DIR__ . '/../application/r4h.php';

$id = new NamedIdentity('Administrator');
LoginService::LoginWithIdentity($id);

error_reporting(E_ERROR);
ini_set('display_errors', 'on');

setlocale(LC_TIME, 'nl_NL.UTF-8');

\EXB\R4\Config::override("product.product_stage", "dev");

$templateText = "
<html>
{% set dateArg     = '08-01-2026' %}
{% set shiftArg    = 'Dagdienst' %}
{% set locationArg = '' %}

{% set Shift = Logbook_getShiftOverview(ShiftId) %}
{% set events = Logbook_getShiftEvents(ShiftId) %}

{% set nAnnounce = Shift.overview.announcements|length %}
{% set nVacation = Shift.overview.vacation|length %}
{% set nPlanning = Shift.overview.planning|length %}

{% set showAnnounce = true %}
{% set showVacation = true %}
{% set showPlanning = true %}
{% if nAnnounce == 0 %}
	{% set showAnnounce = false %}
{% endif %}
{% if nVacation == 0 %}
	{% set showVacation = false %}
{% endif %}
{% if nPlanning == 0 %}
	{% set showPlanning = false %}
{% endif %}

{% set eventsTablePageBreak = true %}
{% if showAnnounce == false and showVacation == false and showPlanning == false %}
	{% set eventsTablePageBreak = false %}
{% endif %}

<head>
	<title>{{ appname }} - {% if Shift.location != '' %} Locatie '{{ Shift.location }}', {% endif%}{{ Shift.displayName }}</title>
</head>
<link href='https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css' rel='stylesheet' integrity='sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB' crossorigin='anonymous'>
<link href='https://demo2.exb-software.com/r6/css/dx.light.css'>
<style type='text/css'>/* ===== FONT ===== */
@font-face {
  font-family: 'Geist Sans';
  font-style: normal;
  font-display: swap;
  font-weight: 400;
  src: url(https://cdn.jsdelivr.net/fontsource/fonts/geist-sans@latest/latin-400-normal.woff2) format('woff2'),
       url(https://cdn.jsdelivr.net/fontsource/fonts/geist-sans@latest/latin-400-normal.woff) format('woff');
}

/* ===== PRINT ===== */
@media print {
  @page {
    size: A4 landscape;
    margin: 10mm;
  }
	
  * {
    -webkit-print-color-adjust: exact;
    print-color-adjust: exact;
  }

  body {
	margin: 0;
  }

  .container,
  .container-fluid {
    padding-left: 0 !important;
    padding-right: 0 !important;
  }

  tr {
    page-break-inside: avoid;
  }
  
  .page-break {
    page-break-before: always;
  }
}

/* ===== GENERAL ===== */
* {
  font-family: 'Segoe UI', Tahoma, Arial, sans-serif;
}

.header {
  font-family: 'Geist Sans', 'Segoe UI', Tahoma, Arial, sans-serif;
  font-size: 16px;
  color: #000;
}

.dim_label {
  font-style:italic;
  color: #777;
}

/* ===== CARDS ===== */
.logscreen .summary-card {
  min-height: 90px;
}

.summary-card.warning {
  border-left: 5px solid #ffc107;
}

.summary-card.danger {
  background: #dc3545;
  color: #fff;
}

.followup-count {
  font-size: 2rem;
  font-weight: bold;
}

.followup-item {
  border-bottom: 1px solid #eee;
  padding-bottom: 6px;
  margin-bottom: 6px;
}

/* ===== TABLE ===== */
.events-table {
  width: 100%;
  border-collapse: collapse;
  font-size: 12px;
  color: #000;
  table-layout: auto;
}

.events-table th,
.events-table td {
  border: 1px solid #e0e0e0;
  padding: 4px 6px;
  vertical-align: top;
  font-family: 'Segoe UI', Tahoma, Arial, sans-serif;
  font-size: 12px;
  color: #000;
}

/* Entire completed event row */
.events-table tr.completed {
    color: #999;
}

/* Force color inheritance for all children */
.events-table tr.completed * {
    color: inherit !important;
}

.events-compact-td {
    padding: 6px 8px;
}

.events-table thead th {
  background: #f5f5f5;
  color: #333;
  font-weight: 600;
  text-align: left;
  white-space: nowrap;
}

.events-table tbody tr:nth-child(even) {
  background-color: #fafafa;
}

.noborder td {
  border: none;
  font-size: 12px;
}

.events-table .actions a {
  display: block;
  margin: 4px 0;
  text-decoration: none;
}

/* ===== BADGES ===== */
.dx-badge {
  display: inline-block;
  padding: 2px 6px;
  font-size: 12px;
  border-radius: 3px;
  background: #fff;
  border: 1px solid #cfcfcf;
}

.dx-badge .header {
  font-size: 16px;
}

dx-badge-header {
  background-color: transparent;
}

/* ===== FOLLOW-UP BLOCK ===== */
.dx-followup {
  margin-top: 4px;
  padding: 6px;
  background: #f7f7f7;
  border: 1px solid #dcdcdc;
  border-radius: 2px;
}

.dx-muted {
  color: #777;
  font-size: 12px;
}

.dx-strong {
  font-weight: 600;
}

/* ===== UTILITIES ===== */
.flex-between {
  display: flex;
  align-items: center;
  justify-content: space-between;
}

.flex-center {
  display: flex;
  align-items: center;
}

.ml-auto {
  margin-left: auto;
}

.badge-full {
  width: 100%;
  padding: 2px;
  margin-top:0px;
  border-top: none;
  border-left: none;
  border-right: none;
}

.badge-full div
{
  padding-bottom:1px;
}

.badge-compact {
  margin: 0px;
  margin-bottom: 1px;
  padding: 2px 6px;
  width: 100%;
}

.badge-compact-header {
	border-bottom: 0px solid #E1E1E1; 
	padding-bottom:0px; 
	margin-bottom:0px;
}

.badge-compact-header div {
	padding-bottom:1px; 
}

.icon-sm {
  width: 16px;
  height: 16px;
}

.icon-xs {
  width: 12px;
  height: 12px;
}

.icon-gap {
  margin-right: 4px;
}

.icon-gap-mail{
	margin-right: 0px;
}
.icon-gap-comment
{
	margin-right: 14px;
}

.description-cell
{
	
}

.status-cell svg
{
	margin-top:3px;
}

.followup-cell {
  padding: 0;
  position: relative;
}

.followup-content {
  padding: 0px;
  padding-right: 8px;
}

.followup-empty {
  margin: 0px;
  margin-top: 2px;
  width: 100%;
  font-style:italic;
}

.followup-body {
  margin-top: 4px;
}

/* ===== STATUS BAR ===== */
.status-bar {
  position: absolute;
  top: 6px;
  bottom: 6px;
  right: 3px;
  width: 5px;
}

.status-bar.active {
  background-color: var(--status-color);
}

/* ===== EVENT DESCRIPTION ===== */
.event-description {
  padding: 3px;
  background-color: #fff;
}

/* ===== LINK ICON ===== */
.event-link {
  display: block;
  margin-top: 2px;
}

.text-green-600{
color:green;
}

.text-red-600{
color:red;
}

</style>
<body>
{{ dump(events) }}
<div class='container-fluid logscreen'>
    <!-- ===== HEADER ===== -->
    <!--<div class='text-center'>-->
	<div class=''>
        <div class='header'>
            <h3>{{ appname }}</h3>
            {% if Shift.location != '' %} Locatie '{{ Shift.location }}', {% endif%}{{ Shift.displayName }}
        </div>
    </div>

    <!-- ===== EMPLOYEES TABLE ===== -->
    <div class='row mt-4'>
        <div class='col'>
            <div class='header'>Medewerkers</div>
            <table class='table table-bordered events-table'>
                <thead class='thead-light'>
                    <tr>
                        <th>Naam (Functie)</th>
                    </tr>
                </thead>
                <tbody>
                    {% for employee in Shift.day_shifts %}
                        <tr>
                            <td>{{ employee.employee|split(' (')[0] }} ({{ employee.position }})</td>                            
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
{% if showAnnounce %}	
	<div class='row mt-4'>
        <div class='col'>
            <div class='header'>Mededelingen</div>
            <table class='table table-bordered events-table'>
                <thead class='thead-light'>
                    <tr>
                        <th width='210px'>Locatie</th>
                        <th>Mededeling</th>
                        <th>Periode</th>
                    </tr>
                </thead>
                <tbody>
					{% for announce in Shift.overview.announcements %}
						<tr>
							<td>{% if announce.location != '' %}{{ announce.location }}{% else %}<i>Alle</i>{% endif %}</td>	
                            <td>{{ announce.title }}</td>
							<td>{{ announce.startdate|date('d-m-Y') }}{% if announce.enddate != '' %} t/m {{ announce.enddate|date('d-m-Y') }}{% else %} >{% endif %}</td>
						</tr>
					{% endfor %}				
	 			</tbody>
            </table>
        </div>
    </div>
{% endif %}
{% if showVacation %}
	<div class='row mt-4'>
        <div class='col'>
            <div class='header'>Absenties</div>
            <table class='table table-bordered events-table'>
                <thead class='thead-light'>
                    <tr>
                        <th width='210px'>Medewerker</th>
                        <th>Periode</th>
                    </tr>
                </thead>
                <tbody>
					{% for absence in Shift.overview.vacation %}
						<tr>
                            <td>{{ absence.employee }}</td><td>{{ absence.startdate }}{% if absence.enddate != '' %} - {{ absence.enddate }}{% else %}&gt;{% endif %}</td>
						</tr>
					{% endfor %}				
	 			</tbody>
            </table>
        </div>
    </div>
{% endif %}

{% if showPlanning %}
	<div class='row mt-4'>
        <div class='col'>
            <div class='header'>Planning</div>
            <table class='table table-bordered events-table'>
                <thead class='thead-light'>
                    <tr>
                        <th width='50px'>Status</th>
						<th>Locatie</th>
                        <th>Activiteit</th>
                        <th>Tijdsplanning</th>						
                    </tr>
                </thead>
                <tbody>
					{% for planning in Shift.overview.planning %}
						<tr>
							<td>
								{% if planning.event %}
									<svg height='16' width='16' xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round' class='lucide lucide-circle-check text-green-600 w-4 h-4'><circle cx='12' cy='12' r='10'></circle><path d='m9 12 2 2 4-4'></path></svg>
								{% else %}
									<svg height='16' width='16' xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round' class='lucide lucide-circle-alert text-red-500 w-4 h-4'><circle cx='12' cy='12' r='10'></circle><line x1='12' x2='12' y1='8' y2='12'></line><line x1='12' x2='12.01' y1='16' y2='16'></line></svg>
								{% endif %}
							</td>
							<td>{% if planning.location != '' %}{{ planning.location }}{% else %}<i>Alle</i>{% endif %}</td>	
                            <td>{{ planning.description }}</td>
							<td>{{ planning.start }} t/m {{ planning.end }}</td>							
						</tr>
					{% endfor %}				
	 			</tbody>
            </table>
        </div>
    </div>
{% endif %}

    <!-- ===== EVENTS TABLE ===== -->
	{% if eventsTablePageBreak %}
		<div class='page-break'></div>
	{% endif %}
    <div class='row mt-4'>
        <div class='col'>
            <div class='header'>Gebeurtenissen</div>
            <table class='table table-bordered events-table'>
                <thead class='thead-light'>
                    <tr>
						<th width='18px'></th>						
                        {% if area != false %}
							<th>Area</th>
						{% endif %}						
						{% if stilstand != false %}							
							<th width='35px'>Stilstand</th>							
						{% endif %}
                        <th >Locatie</th>
                        <th >Gebeurtenis</th>
                        <th width='30%'>Beschrijving</th>
						<th width='18px'></th>
                        <th width='30%'>Opvolging</th>						
                    </tr>
                </thead>
                <tbody>
                    {% for event in events.data %}
                        <tr class='{% if event.completed %}completed{% endif %}'>
							
							<td>		
							<!-- <pre>{{ dump(event) }} -->
																					
							{% set link = document_link_external(document('1000',event.id)) %}
								<a class='event-link' href='{{ link|split('href=\'')[1]|split('\'')[0]|trim }}' target='_blank'>
									<svg width='12px' height='12px' viewBox='0 0 24 24' fill='none' xmlns='http://www.w3.org/2000/svg'>
									  <g id='SVGRepo_bgCarrier' stroke-width='0'></g>
									  <g id='SVGRepo_tracerCarrier' stroke-linecap='round' stroke-linejoin='round'></g>
									  <g id='SVGRepo_iconCarrier'>
										<path fill-rule='evenodd' clip-rule='evenodd' d='M10.975 14.51a1.05 1.05 0 0 0 0-1.485 2.95 2.95 0 0 1 0-4.172l3.536-3.535a2.95 2.95 0 1 1 4.172 4.172l-1.093 1.092a1.05 1.05 0 0 0 1.485 1.485l1.093-1.092a5.05 5.05 0 0 0-7.142-7.142L9.49 7.368a5.05 5.05 0 0 0 0 7.142c.41.41 1.075.41 1.485 0zm2.05-5.02a1.05 1.05 0 0 0 0 1.485 2.95 2.95 0 0 1 0 4.172l-3.5 3.5a2.95 2.95 0 1 1-4.171-4.172l1.025-1.025a1.05 1.05 0 0 0-1.485-1.485L3.87 12.99a5.05 5.05 0 0 0 7.142 7.142l3.5-3.5a5.05 5.05 0 0 0 0-7.142 1.05 1.05 0 0 0-1.485 0z' fill='#000000'></path>
									  </g>
									</svg>
								</a>
							</td>
							
                            <!-- Area -->
							{% if area != false %}
                            	<td>{{ event[area|split(',')[0]] }}</td>
							{% endif %}
                            <!-- Stilstand -->
							{% if stilstand != false %}
                            	<td>{{ event.stilstand ? 'Ja' : '' }}</td>
							{% endif %}
                            <!-- Locatie -->
                            <td>
                                {{ event.location }}<br/>{{ event.sublocation }}
                            </td>

                            <!-- Soort gebeurtenis -->
                            <td>
                                {{ event.activity }}
                            </td>

                            <!-- Omschrijving -->
                            <td class='description-cell'>
                                <div class='dx-badge badge-full'>
                                    <div class='dx-badge-header flex-between'>
                                        <div><span class='dim_label'>Door:</span> {{ event.tekst.author }}</div>
                                        <div>
										{% if event.for_transfer or true %}	
											<svg style='vertical-align: middle;' xmlns='http://www.w3.org/2000/svg' width='10' height='10' fill='{% if event.completed %}gray{% else %}black{% endif %}' class='bi bi-clipboard' viewBox='0 0 16 16'>
											<path d='M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z'/>
												<path d='M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z'/411>
											</svg>
										{% endif %}	
										
										{{ event.tekst.date|date('d-m-Y H:i') }} {% if event.completed %}- {{ event.time|date('d-m-Y')~' '~event.date|date('H:i') }}{% endif %}</div>

                                    </div>
                                </div>
                                <div class='event-description{% if event.tekst.text == '' %}-empty{% endif %}' >{{ event.tekst.text }}</div>
                            </td>

							<!-- Status -->
							<td class='status-cell'>
							{% if event.params.followup or event.params.followup_email %}
								{% if event.completed %}
									<svg stroke='currentColor' fill='currentColor' stroke-width='0' viewBox='0 0 24 24' class='text-green-600' height='14' width='14' xmlns='http://www.w3.org/2000/svg'><path fill='none' d='M0 0h24v24H0V0z'></path><path d='M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V5h14v14zM17.99 9l-1.41-1.42-6.59 6.59-2.58-2.57-1.42 1.41 4 3.99z'></path></svg>
								{% else %}
									<svg stroke='currentColor' fill='currentColor' stroke-width='0' viewBox='0 0 24 24' class='text-gray-700' height='14' width='14' xmlns='http://www.w3.org/2000/svg'>
  <path fill='none' d='M0 0h24v24H0z'></path>
  <path d='M19 5v14H5V5h14m0-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2z'></path>
</svg>							
								{% endif %}
							{% endif %}
							</td>


                            <!-- Opvolging -->
                            <td class='followup-cell'>
							  <div class='followup-content'>
								{% if event.mails|length > 0 %}	
																
									{% for mail in event.mails %}	
									  <div class='dx-badge badge-compact'>
										<div class='flex-between badge-compact-header'>
											<div class='flex-center'>
												{% if mail.type != 'conversation' %}
													{# mail.type #}
													
												{% if mail.direction == '' or mail.direction == 'uitgaand' %}	
													<svg class='icon-sm icon-gap-mail' viewBox='0 0 24 24' fill='none' xmlns='http://www.w3.org/2000/svg'><g id='SVGRepo_bgCarrier' stroke-width='0'></g><g id='SVGRepo_tracerCarrier' stroke-linecap='round' stroke-linejoin='round'></g><g id='SVGRepo_iconCarrier'> <path d='M4 18L9 12M20 18L15 12M3 8L10.225 12.8166C10.8665 13.2443 11.1872 13.4582 11.5339 13.5412C11.8403 13.6147 12.1597 13.6147 12.4661 13.5412C12.8128 13.4582 13.1335 13.2443 13.775 12.8166L21 8M6.2 19H17.8C18.9201 19 19.4802 19 19.908 18.782C20.2843 18.5903 20.5903 18.2843 20.782 17.908C21 17.4802 21 16.9201 21 15.8V8.2C21 7.0799 21 6.51984 20.782 6.09202C20.5903 5.71569 20.2843 5.40973 19.908 5.21799C19.4802 5 18.9201 5 17.8 5H6.2C5.0799 5 4.51984 5 4.09202 5.21799C3.71569 5.40973 3.40973 5.71569 3.21799 6.09202C3 6.51984 3 7.07989 3 8.2V15.8C3 16.9201 3 17.4802 3.21799 17.908C3.40973 18.2843 3.71569 18.5903 4.09202 18.782C4.51984 19 5.07989 19 6.2 19Z' stroke='#000000' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'></path> </g></svg>	
													<!-- arrow -->
													<svg  class='icon-sm' width='32px' height='32px' viewBox='6 0 18 24' fill='none' xmlns='http://www.w3.org/2000/svg'>
													<g id='SVGRepo_bgCarrier' stroke-width='0'></g>
													<g id='SVGRepo_tracerCarrier' stroke-linecap='round' stroke-linejoin='round'></g>
													<g id='SVGRepo_iconCarrier' {% if mail.type == 'inbox' %} transform='scale(-1,1) translate(-24,0)' {% endif %}> 
														<g id='Arrow / Arrow_Right_SM'> <path id='Vector' d='M7 12H17M17 12L13 8M17 12L13 16' stroke='#000000' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'></path> </g> 
													</g>
													</svg>
<!-- transform='scale(-1,1) translate(-24,0)' on iconcarrier -->
													
												{% else %} 	
												<svg class='icon-sm icon-gap text-gray-700' viewBox='0 0 24 24' fill='none' xmlns='http://www.w3.org/2000/svg'>
												  <g id='SVGRepo_bgCarrier' stroke-width='0'></g>
												  <g id='SVGRepo_tracerCarrier' stroke-linecap='round' stroke-linejoin='round'></g>
												  <g id='SVGRepo_iconCarrier'>
													<path fill-rule='evenodd' clip-rule='evenodd' d='M2.8 4C1.86451 4 1.0468 4.46923 0.544325 5.16792C0.20074 5.64567 0 6.23499 0 6.86667V17.1333C0 18.682 1.21964 20 2.8 20H10.2C10.7523 20 11.2 19.5523 11.2 19C11.2 18.4477 10.7523 18 10.2 18H2.8C2.39214 18 2 17.6466 2 17.1333V7.94766L7.77948 14.3096C8.96986 15.6199 11.0301 15.6199 12.2205 14.3096L18 7.94766V12.1333C18 12.6856 18.4477 13.1333 19 13.1333C19.5523 13.1333 20 12.6856 20 12.1333V6.86667C20 6.235 19.7993 5.64567 19.4557 5.16792C18.9532 4.46923 18.1355 4 17.2 4H2.8ZM9.25983 12.9647L2.9327 6H17.0673L10.7402 12.9647C10.3434 13.4015 9.65662 13.4015 9.25983 12.9647ZM18.7071 16.7071C19.0976 16.3166 19.0976 15.6834 18.7071 15.2929C18.3166 14.9024 17.6834 14.9024 17.2929 15.2929L14.2929 18.2929C13.9024 18.6834 13.9024 19.3166 14.2929 19.7071L17.2929 22.7071C17.6834 23.0976 18.3166 23.0976 18.7071 22.7071C19.0976 22.3166 19.0976 21.6834 18.7071 21.2929L17.4142 20H22C22.5523 20 23 19.5523 23 19C23 18.4477 22.5523 18 22 18H17.4142L18.7071 16.7071Z' fill='#000000'></path>
												  </g>
												</svg>

												{% endif %}


												{% else %}													
													<svg class='icon-sm icon-gap-comment text-gray-700' stroke='currentColor' fill='currentColor' stroke-width='0' viewBox='0 0 24 24' xmlns='http://www.w3.org/2000/svg'>
														<path fill='none' d='M0 0h24v24H0V0z'></path>
														<path d='M17 19.22H5V7h7V5H5c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2v-7h-2v7.22z'></path>
														<path d='M19 2h-2v3h-3c.01.01 0 2 0 2h3v2.99c.01.01 2 0 2 0V7h3V5h-3V2zM7 9h8v2H7zM7 12v2h8v-2h-3zM7 15h8v2H7z'></path>
													</svg>
												{% endif %}
												<div><span class='dim_label'>Door:</span> {{ mail.author }}</div>
											</div>
											<div class='ml-auto'>{{ mail.date|date('d-m-Y H:i') }}</div>
										</div>

										{% if showBody %}
											<div class='followup-body'>{{ mail.text|raw|replace({'<br><br><br>':'<br>'})|replace({'<br><br>':'<br>'}) }}</div>
										{% endif %}
									</div>

									 {% endfor %}

								{% else %}
								  <div class='dx-muted followup-empty'>Geen opvolging</div>
								{% endif %}
							  </div>

							  <!-- status bar -->
							  <div class='status-bar' {% if event.completed == false %}style='background-color: {{ event.backgroundColor }};'{% endif %}></div>
							</td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

</div>

</body>
</html>
";

$template = new  \EXB\Kernel\Template(new Stringloader($templateText));

/* 
int ShiftId (incident id): id to fetch data [required]
bool showEventLinks: showing outer left column with url link at event rows, keep true!
bool showBody: show email body text for each email on event 
*/
$appname = \EXB\R4\Config::get('r6.app_name','Digitaal Logboek');
$area = \EXB\R4\Config::get('logbook:event.columns_before_1',false);
$stilstand = \EXB\R4\Config::get('logbook:event.columns_before_2',false);

echo $template->render($templateText, ['appname' => $appname,'ShiftId' => 38367,'showBody' => true,'area' => $area,'stilstand' => $stilstand]);
